@inject Birlik_Mobile.Services.AuthService AuthService
@inject NavigationManager NavManager
@using Birlik_Mobile.Components.Layout


<!-- Menú lateral moderno -->
<div class="nav-menu @(IsOpen ? "open" : "")">
    <div class="menu-header">
        <div class="brand-section">
            <div class="brand-logo">
                <i class="bi bi-shield-check"></i>
            </div>
            <div class="brand-text">
                <h4>Birlik</h4>
                <p>Corredor de Seguros</p>
            </div>
        </div>
        
        @if (AuthService.CurrentUser != null)
        {
            <div class="user-profile">
                <div class="user-avatar">
                    <i class="bi bi-person-circle"></i>
                </div>
                <div class="user-info">
                    <span class="user-name">@AuthService.CurrentUser.Usuario</span>
                    <span class="user-role">@AuthService.CurrentUser.Rol</span>
                </div>
            </div>
        }
    </div>

    <nav class="menu-content">
        @if (AuthService.CurrentUser is not null)
        {
            var rol = AuthService.CurrentUser.Rol?.ToLower() ?? "";

            <div class="menu-section">
                <h6 class="section-title">Navegación</h6>
                
                @switch (rol)
                {
                    case "cliente":
                        <NavLink href="/cliente/dashboard" class="nav-item" Match="NavLinkMatch.All" @onclick="CloseMenu">
                            <div class="nav-icon">
                                <i class="bi bi-house-door"></i>
                            </div>
                            <span class="nav-text">Inicio</span>
                            <div class="nav-arrow">
                                <i class="bi bi-chevron-right"></i>
                            </div>
                        </NavLink>
                        
                        <NavLink href="/cliente/polizas" class="nav-item" @onclick="CloseMenu">
                            <div class="nav-icon">
                                <i class="bi bi-shield-check"></i>
                            </div>
                            <span class="nav-text">Mis Pólizas</span>
                            <div class="nav-arrow">
                                <i class="bi bi-chevron-right"></i>
                            </div>
                        </NavLink>
                        
                        <NavLink href="/cliente/facturas" class="nav-item" @onclick="CloseMenu">
                            <div class="nav-icon">
                                <i class="bi bi-receipt"></i>
                            </div>
                            <span class="nav-text">Mis Facturas</span>
                            <div class="nav-arrow">
                                <i class="bi bi-chevron-right"></i>
                            </div>
                        </NavLink>
                        
                        <NavLink href="/cliente/datos" class="nav-item" @onclick="CloseMenu">
                            <div class="nav-icon">
                                <i class="bi bi-person-lines-fill"></i>
                            </div>
                            <span class="nav-text">Datos Personales</span>
                            <div class="nav-arrow">
                                <i class="bi bi-chevron-right"></i>
                            </div>
                        </NavLink>
                        
                        <NavLink href="/cliente/emergencia" class="nav-item emergency" @onclick="CloseMenu">
                            <div class="nav-icon">
                                <i class="bi bi-exclamation-triangle"></i>
                            </div>
                            <span class="nav-text">Emergencia</span>
                            <div class="nav-badge">SOS</div>
                        </NavLink>
                        break;

                    case "gerente":
                        <NavLink href="/gerente/dashboard" class="nav-item" Match="NavLinkMatch.All" @onclick="CloseMenu">
                            <div class="nav-icon">
                                <i class="bi bi-speedometer2"></i>
                            </div>
                            <span class="nav-text">Dashboard</span>
                            <div class="nav-arrow">
                                <i class="bi bi-chevron-right"></i>
                            </div>
                        </NavLink>
                        
                        <NavLink href="/gerente/reportes" class="nav-item" @onclick="CloseMenu">
                            <div class="nav-icon">
                                <i class="bi bi-graph-up"></i>
                            </div>
                            <span class="nav-text">Reportes</span>
                            <div class="nav-arrow">
                                <i class="bi bi-chevron-right"></i>
                            </div>
                        </NavLink>
                        
                        <NavLink href="/gerente/supervision" class="nav-item" @onclick="CloseMenu">
                            <div class="nav-icon">
                                <i class="bi bi-people"></i>
                            </div>
                            <span class="nav-text">Supervisión</span>
                            <div class="nav-arrow">
                                <i class="bi bi-chevron-right"></i>
                            </div>
                        </NavLink>
                        
                        <NavLink href="/gerente/configuracion" class="nav-item" @onclick="CloseMenu">
                            <div class="nav-icon">
                                <i class="bi bi-gear"></i>
                            </div>
                            <span class="nav-text">Configuración</span>
                            <div class="nav-arrow">
                                <i class="bi bi-chevron-right"></i>
                            </div>
                        </NavLink>
                        break;

                    case "operativo":
                        <NavLink href="/operativo/dashboard" class="nav-item" Match="NavLinkMatch.All" @onclick="CloseMenu">
                            <div class="nav-icon">
                                <i class="bi bi-speedometer2"></i>
                            </div>
                            <span class="nav-text">Dashboard</span>
                            <div class="nav-arrow">
                                <i class="bi bi-chevron-right"></i>
                            </div>
                        </NavLink>
                        
                        <NavLink href="/operativo/clientes" class="nav-item" @onclick="CloseMenu">
                            <div class="nav-icon">
                                <i class="bi bi-person-vcard"></i>
                            </div>
                            <span class="nav-text">Clientes</span>
                            <div class="nav-arrow">
                                <i class="bi bi-chevron-right"></i>
                            </div>
                        </NavLink>
                        
                        <NavLink href="/operativo/polizas" class="nav-item" @onclick="CloseMenu">
                            <div class="nav-icon">
                                <i class="bi bi-shield"></i>
                            </div>
                            <span class="nav-text">Pólizas</span>
                            <div class="nav-arrow">
                                <i class="bi bi-chevron-right"></i>
                            </div>
                        </NavLink>
                        
                        <NavLink href="/operativo/inclusiones" class="nav-item" @onclick="CloseMenu">
                            <div class="nav-icon">
                                <i class="bi bi-person-plus"></i>
                            </div>
                            <span class="nav-text">Inclusiones</span>
                            <div class="nav-arrow">
                                <i class="bi bi-chevron-right"></i>
                            </div>
                        </NavLink>
                        
                        <NavLink href="/operativo/siniestros" class="nav-item" @onclick="CloseMenu">
                            <div class="nav-icon">
                                <i class="bi bi-exclamation-triangle"></i>
                            </div>
                            <span class="nav-text">Siniestros</span>
                            <div class="nav-arrow">
                                <i class="bi bi-chevron-right"></i>
                            </div>
                        </NavLink>
                        
                        <NavLink href="/operativo/produccion" class="nav-item" @onclick="CloseMenu">
                            <div class="nav-icon">
                                <i class="bi bi-bar-chart-line"></i>
                            </div>
                            <span class="nav-text">Producción</span>
                            <div class="nav-arrow">
                                <i class="bi bi-chevron-right"></i>
                            </div>
                        </NavLink>
                        break;
                }
            </div>

            <div class="menu-section">
                <h6 class="section-title">Sistema</h6>
                <button class="nav-item logout" @onclick="CerrarSesion">
                    <div class="nav-icon">
                        <i class="bi bi-box-arrow-right"></i>
                    </div>
                    <span class="nav-text">Cerrar sesión</span>
                    <div class="nav-arrow">
                        <i class="bi bi-chevron-right"></i>
                    </div>
                </button>
            </div>
        }
        else
        {
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="bi bi-person-circle"></i>
                </div>
                <p>Inicia sesión para ver el menú</p>
            </div>
        }
    </nav>

    <div class="menu-footer">
        <div class="version-info">
            <small>Versión 1.0.0</small>
            <small>© 2024 Birlik</small>
        </div>
    </div>
</div>

@code {
    [Parameter] public bool IsOpen { get; set; }
    [Parameter] public EventCallback OnClose { get; set; }

    private async Task CloseMenu()
    {
        if (OnClose.HasDelegate)
        {
            await OnClose.InvokeAsync();
        }
    }

    private async Task CerrarSesion()
    {
        await AuthService.LogoutAsync();
        NavManager.NavigateTo("/login");
    }
}
